package app.alan.reactmodule;

import com.facebook.react.bridge.Arguments;
import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.ReactContextBaseJavaModule;
import com.facebook.react.bridge.WritableMap;
import com.facebook.react.modules.core.DeviceEventManagerModule;

import org.json.JSONException;
import org.json.JSONObject;

import javax.annotation.Nullable;

public class AlanEventEmitter extends ReactContextBaseJavaModule {

    private final static String REACT_CLASS = "AlanEventEmitter";
    public static AlanEventEmitter INSTANCE;

    public AlanEventEmitter(ReactApplicationContext reactContext) {
        super(reactContext);
        INSTANCE = this;
    }

    @Override
    public String getName() {
        return REACT_CLASS;
    }

    public void onConnected(JSONObject json) {
        // Create map for params
        WritableMap payload = Arguments.createMap();
        // Put data to map
        JSONObject data = new JSONObject();
        try {
            data = json.getJSONObject("data");

            payload.putString("command", data.getString("command"));
            payload.putString("text", data.getString("text"));
        } catch (JSONException e) {
            e.printStackTrace();
        }

        // Get EventEmitter from context and send event thanks to it
        getReactApplicationContext()
                .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)
                .emit("command", payload);
    }

}
